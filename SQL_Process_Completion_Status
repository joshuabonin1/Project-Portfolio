WITH ISDT AS    (SELECT DISTINCT WHISDT AS DATE1 FROM SHV21BAPD.CUDHDR00 WHERE WHSTAT>='00' ORDER BY WHISDT DESC LIMIT 4),

DISTROS_OV AS   (SELECT DTISDT AS ISDT, CAST(COUNT(CASE WHEN DTSTAT<>90 THEN DTDSTR ELSE NULL END) AS FLOAT) AS "TO_COMPLETE", CAST(COUNT(CASE WHEN DTSTAT<90 THEN DTDSTR ELSE NULL END) AS FLOAT) AS "INCOMPLETE"
FROM SHV21BAPD.DTSTOR00
WHERE DTISDT IN (SELECT DATE1 FROM ISDT) AND TO_DATE(LTRIM(DTISDT), 'YYYYMMDD') <> (CURRENT DATE + 2 DAYS)
AND DTMIS7 NOT IN ('36104','36105','36180','36184','36148','36149','36159','36174','36177','36180','36182','36194','36195','36426')
GROUP BY DTISDT
ORDER BY DTISDT DESC),

DISTROS_CSYCGTBKY AS (SELECT DTISDT AS ISDT, CAST(COUNT(CASE WHEN DTSTAT<>90 THEN DTDSTR ELSE NULL END) AS FLOAT) AS "TO_COMPLETE", CAST(COUNT(CASE WHEN DTSTAT<90 THEN DTDSTR ELSE NULL END) AS FLOAT) AS "INCOMPLETE"
FROM SHV21BAPD.DTSTOR00
WHERE DTISDT IN (SELECT DATE1 FROM ISDT) AND TO_DATE(LTRIM(DTISDT), 'YYYYMMDD') <> (CURRENT DATE + 2 DAYS)
AND DTMIS7 IN ('36104','36105','36180','36184','36148','36149','36159','36174','36177','36180','36182','36194','36195','36426')
GROUP BY DTISDT
ORDER BY DTISDT DESC),                

LOADWH AS (SELECT SUBSTR(CHMIS8,2,8) AS LOADISDT, CHCASN AS CARTON, CHSTAT AS STAT, CHMIS1 AS DSP
FROM SHV21BAPD.CHCART00
WHERE SUBSTR(CHMIS8,2,8) IN (SELECT DATE1 FROM ISDT) AND TO_DATE(SUBSTR(CHMIS8,2,8), 'YYYYMMDD') <> (CURRENT DATE + 2 DAYS)
AND CHMIS8<>''
AND CHCRTP NOT IN ('CGT', 'CSY', 'BKR', 'PIZ')
GROUP BY SUBSTR(CHMIS8,2,8), CHCASN, CHSTAT, CHMIS1
ORDER BY SUBSTR(CHMIS8,2,8) DESC, DSP),

LOADCDC AS       (SELECT SUBSTR(CHMIS8,2,8) AS LOADISDT, CHCASN AS CARTON, CHSTAT AS STAT, CHMIS1 AS DSP, CHROUT AS ROUT
FROM SHV21BAPD.CHCART00
WHERE SUBSTR(CHMIS8,2,8) IN (SELECT DATE1 FROM ISDT) AND TO_DATE(SUBSTR(CHMIS8,2,8), 'YYYYMMDD') <> (CURRENT DATE + 2 DAYS)
AND CHMIS8<>''
AND CHCRTP IN ('CGT', 'CSY', 'BKR', 'PIZ')
GROUP BY SUBSTR(CHMIS8,2,8), CHCASN, CHSTAT, CHMIS1, CHROUT
ORDER BY SUBSTR(CHMIS8,2,8) DESC, DSP),

ptsACTIVE AS (SELECT WHDPNM, WHISDT AS PTSAISDT, COUNT(*) AS COUNTPTS, CASE WHEN WHMIS1>='10' THEN 1 ELSE 0 END as ACTIVE1 FROM SHV21BAPD.CUDHDR00 WHERE WHISDT IN (SELECT DATE1 FROM ISDT)
GROUP BY WHISDT, WHMIS1, WHDPNM),

ptsCLOSED AS (SELECT WHDPNM, WHISDT AS PTSCISDT, COUNT(*) AS COUNTPTS, CASE WHEN WHMIS1='90' THEN 1 ELSE 0 END AS CLOSE1 FROM SHV21BAPD.CUDHDR00 WHERE WHISDT IN (SELECT DATE1 FROM ISDT)
GROUP BY WHISDT, WHMIS1, WHDPNM),

DSPACTIVE AS (SELECT WHDPNM, WHISDT AS DSPAISDT, COUNT(*) AS COUNTPTS, CASE WHEN WHSTAT>='10' THEN 1 ELSE 0 END AS ACTIVE1 FROM SHV21BAPD.CUDHDR00 WHERE WHISDT IN (SELECT DATE1 FROM ISDT)
GROUP BY WHISDT, WHSTAT, WHDPNM),

DSPCLOSE AS (SELECT WHDPNM, WHISDT AS DSPCISDT, COUNT(*) AS COUNTPTS, CASE WHEN WHSTAT='90' THEN 1 ELSE 0 END AS CLOSE1 FROM SHV21BAPD.CUDHDR00 WHERE WHISDT IN (SELECT DATE1 FROM ISDT)
GROUP BY WHISDT, WHSTAT, WHDPNM),

CSYACTIVE AS (SELECT CYISDT AS CSYAISDT, CASE WHEN CYSTAT>='10' THEN 100 ELSE 0 END AS CSYA FROM SHV21BAPD.XLCYHD00 WHERE CYISDT IN (SELECT DATE1 FROM ISDT)
GROUP BY CYISDT, CYSTAT),

CSYCLOSED AS (SELECT CYISDT AS CSYCISDT, CASE WHEN CYSTAT='90' THEN 100 ELSE 0 END AS CSYC FROM SHV21BAPD.XLCYHD00 WHERE CYISDT IN (SELECT DATE1 FROM ISDT)
GROUP BY CYISDT, CYSTAT),

A AS (select distinct(chrout) AS ROUTES, SUBSTR(chmis8, 2, 8) AS OLDDATE from shv21bapd.chcart00
where chstat='85' and chmis8 <> ''
group by SUBSTR(chmis8, 2, 8), CHROUT
order by SUBSTR(chmis8, 2, 8), chrout),

A2 AS (select substr(RLMI20, 2, 8) AS CURRENT1, RLROUT AS ROUTES1 FROM SHV21BAPD.RLROUT00
WHERE RLROUT BETWEEN '1001' AND '1135' AND RLRCTP='W' AND RLSTAT='35'
OR RLROUT IN ('TDWR','GDBR') AND RLRCTP='W' AND RLSTAT='35'
ORDER BY RLROUT
),

WAVES_OV AS     (SELECT DTISDT AS "OVISDT", DTPRWV AS "OVWAVES" FROM SHV21BAPD.DTSTOR00 WHERE DTISDT IN (SELECT DATE1 FROM ISDT) GROUP BY DTISDT, DTPRWV),

OPENWAVES AS    (SELECT DISTINCT WDPRWV FROM SHV21BAPD.WDWAVE00 WHERE WDWVST<'90' AND TRIM(WDDOWK)||TRIM(WDSHFT) <>'108'),

WWWAVES AS      (SELECT DTISDT AS "OPISDT", DTPRWV AS "DTWAVES" FROM SHV21BAPD.DTSTOR00 WHERE DTISDT IN (SELECT DATE1 FROM ISDT) GROUP BY DTISDT, DTPRWV),

PDWAVES AS      (SELECT PDSDDT AS "PISDT", PDPRWV AS "PIWAVE" FROM SHV21BAPD.PDPICK00 WHERE PDSTAT<'83' AND PDSDDT IN (SELECT DATE1 FROM ISDT) AND PDPRWV IN (SELECT WDPRWV FROM OPENWAVES) GROUP BY PDSDDT, PDPRWV), 

waved as (SELECT PXREF3 AS DISTRO_WAVED, PXSTYL AS "SLIN", PXSSFX AS "LDU", PXINVA AS "UNITS"                                                   
FROM SHV21BAPD.PXSTYL00                                                                         
JOIN SHV21BAPD.WDWAVE00 ON WDPRWV=PXREF2   
JOIN SHV21BAPD.DTSTOR00 ON DTDSTR=PXREF3 AND TRIM(DTSTYL)||TRIM(DTSSFX)=TRIM(PXSTYL)||TRIM(PXSSFX)                                   
WHERE DTISDT IN (SELECT DATE1 FROM ISDT)--(date (substr(PXDCR ,1,4)||'-'||substr(PXDCR ,5,2)||'-'||substr(PXDCR ,7,2)))>=(CURRENT DATE - 5 DAYS)                                              
AND PXTXTP='620' AND PXTXCD='01' AND PXACCD='02'      
AND WDWVST >= '15' AND WDWVST <'99'                                       
GROUP BY PXREF3, PXSTYL, PXSSFX, PXINVA
ORDER BY PXREF3, PXSTYL, PXSSFX),

ALLDISTRO AS (SELECT DTDSTR DISTRO, DTISDT, DTMIS1, DTSTYL, DTSSFX, DTRQQT
FROM SHV21BAPD.DTSTOR00
WHERE DTISDT IN (SELECT DATE1 FROM ISDT)
) 

SELECT CUCDDS AS "PROCESS STEP", ISDT, ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) AS "%COMPLETE", 
CASE WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) = 100 THEN 'G'
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) < 100 AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END AS "STATUS"
FROM DISTROS_OV
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'OVERALL_DISTRO_CLEANUP'
UNION ALL               
SELECT CUCDDS, ISDT, ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) AS "%COMPLETE", 
CASE WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) = 100 THEN 'G'
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND(((1-(INCOMPLETE/TO_COMPLETE))*100),2) < 100 AND TO_DATE(LTRIM(ISDT), 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y'
ELSE '' END
FROM DISTROS_CSYCGTBKY
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'OTHER_DISTRO_CLEANUP'
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) = 100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D6_WHOLESALE_PTS_LOADING'
RIGHT JOIN LOADWH ON DATE1=LOADISDT
WHERE DSP='0006' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 
 
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0006' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE 'G' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D6_OTHER_LOADING'
RIGHT JOIN LOADCDC ON DATE1=LOADISDT
WHERE DSP='0006' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) = 100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D5_WHOLESALE_PTS_LOADING'
RIGHT JOIN LOADWH ON DATE1=LOADISDT
WHERE DSP='0005' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 
 
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) = 100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0005' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D5_OTHER_LOADING'
RIGHT JOIN LOADCDC ON DATE1=LOADISDT
WHERE DSP='0005' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100, 2) =100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D4_WHOLESALE_PTS_LOADING'
RIGHT JOIN LOADWH ON DATE1=LOADISDT
WHERE DSP='0004' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 

UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) = 100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0004' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D4_OTHER_LOADING'
RIGHT JOIN LOADCDC ON DATE1=LOADISDT
WHERE DSP='0004' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) = 100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D3_WHOLESALE_PTS_LOADING'
RIGHT JOIN LOADWH ON DATE1=LOADISDT
WHERE DSP='0003' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 

UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) =100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0003' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D3_OTHER_LOADING'
RIGHT JOIN LOADCDC ON DATE1=LOADISDT
WHERE DSP='0003' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) =100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D2_WHOLESALE_PTS_LOADING'
RIGHT JOIN LOADWH ON DATE1=LOADISDT
WHERE DSP='0002' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 

UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) =100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0002' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D2_OTHER_LOADING'
RIGHT JOIN LOADCDC ON DATE1=LOADISDT
WHERE DSP='0002' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) =100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D1_WHOLESALE_PTS_LOADING'
RIGHT JOIN LOADWH ON DATE1=LOADISDT
WHERE DSP='0001' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 
 
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) =100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) BETWEEN 80 AND 99.99 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADWH WHERE STAT<'60' AND DSP='0001' AND LOADISDT=DATE1 )/(COUNT(CARTON)))) * 100, 2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'D1_OTHER_LOADING'
RIGHT JOIN LOADCDC ON DATE1=LOADISDT
WHERE DSP='0001' 
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS 
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('TDWR','TDWS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('TDWR','TDWS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) =100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('TDWR','TDWS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) < 100 AND CURRENT TIME > CUMSFL AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('TDWR','TDWS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('TDWR','TDWS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('TDWR','TDWS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('TDWR','TDWS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'TDWR_LOADING'
RIGHT JOIN LOADCDC ON DATE1=LOADISDT
WHERE ROUT IN ('TDWR','TDWS')
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS
UNION ALL
SELECT CUCDDS, DATE1, ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('GDBR','GDBS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) AS "%COMPLETE" , 
CASE WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('GDBR','GDBS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) =100 THEN 'G'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('GDBR','GDBS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) < 100 AND CURRENT TIME > CUMSFL AND 
((CURRENT TIME > CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LOADISDT, 'YYYYMMDD') <= CURRENT DATE) THEN 'R'
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('GDBR','GDBS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('GDBR','GDBS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('GDBR','GDBS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LOADISDT, 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1 - ((SELECT NVL(COUNT(DISTINCT CARTON), 0) FROM LOADCDC WHERE STAT<'60' AND ROUT IN ('GDBR','GDBS') AND LOADISDT=DATE1)/(COUNT(CARTON)))) * 100,2) < 100 AND TO_DATE(LOADISDT, 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END 
FROM ISDT
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'GDBR_LOADING'
RIGHT JOIN LOADCDC ON DATE1=LOADISDT
WHERE ROUT IN ('GDBR','GDBS')
GROUP BY DATE1, LOADISDT, CUCDDS, CUMSFL, CUSHDS
UNION ALL
SELECT CUCDDS, PTSAISDT, ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) AS "%COMPLETE" , 
CASE WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) = 100 THEN 'G'
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(PTSAISDT), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(PTSAISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(PTSAISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(PTSAISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY)THEN 'Y' 
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 100 AND TO_DATE(LTRIM(PTSAISDT), 'YYYYMMDD') = (CURRENT DATE + 2 DAYS)THEN 'Y' 
ELSE '' END
FROM ptsACTIVE
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'PTS_ACTIVATED'
GROUP BY PTSAISDT, CUCDDS, CUSHDS, CUMSFL
UNION ALL
SELECT CUCDDS, PTSCISDT, ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) AS "%COMPLETE" , 
CASE WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) = 100 THEN 'G'
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(PTSCISDT), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(PTSCISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(PTSCISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(PTSCISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 100 AND TO_DATE(LTRIM(PTSCISDT), 'YYYYMMDD') = (CURRENT DATE + 2 DAY) THEN 'Y' 
ELSE '' END
FROM ptsCLOSED
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'PTS_CLOSED'
GROUP BY PTSCISDT, CUCDDS, CUSHDS, CUMSFL
UNION ALL
SELECT CUCDDS, DSPAISDT, ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) AS "%COMPLETE" , 
CASE WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) = 100 THEN 'G'
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(DSPAISDT), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DSPAISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DSPAISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(DSPAISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((FLOAT(SUM(ACTIVE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 100 AND TO_DATE(LTRIM(DSPAISDT), 'YYYYMMDD') = (CURRENT DATE + 2 DAY) THEN 'Y' 
ELSE '' END
FROM DSPACTIVE
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'DISPATCH_ACTIVATED'
GROUP BY DSPAISDT, CUCDDS, CUSHDS, CUMSFL
UNION ALL
SELECT CUCDDS, DSPCISDT, ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) AS "%COMPLETE" , 
CASE WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) = 100 THEN 'G'
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 100 AND TO_DATE(LTRIM(DSPCISDT), 'YYYYMMDD') <= (CURRENT DATE) THEN 'R' 
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(DSPCISDT), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DSPCISDT), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DSPCISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(DSPCISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((FLOAT(SUM(CLOSE1))/FLOAT(SUM(COUNTPTS)))*100,2) < 100 AND TO_DATE(LTRIM(DSPCISDT), 'YYYYMMDD') >= (CURRENT DATE + 1 DAY) THEN 'Y' 
ELSE '' END
FROM DSPCLOSE
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'DISPATCH_CLOSED'
GROUP BY DSPCISDT, CUCDDS, CUSHDS, CUMSFL
UNION ALL
SELECT CUCDDS, CSYAISDT, CSYA AS "%COMPLETE" , 
CASE WHEN CSYA = 100 THEN 'G'
WHEN CSYA < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(CSYAISDT), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN CSYA < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(CSYAISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN CSYA BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(CSYAISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN CSYA < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(CSYAISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN CSYA < 100 AND TO_DATE(LTRIM(CSYAISDT), 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END
FROM CSYACTIVE
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'CSY_ACTIVATED'
UNION ALL
SELECT CUCDDS, CSYCISDT, CSYC AS "%COMPLETE" , 
CASE WHEN CSYC = 100 THEN 'G'
WHEN CSYC < 100 AND ((CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(CSYCISDT), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY)) OR TO_DATE(LTRIM(CSYCISDT), 'YYYYMMDD') <= (CURRENT DATE)) THEN 'R' 
WHEN CSYC < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(CSYCISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN CSYC BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(CSYCISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN CSYC < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(CSYCISDT), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN CSYC < 100 AND TO_DATE(LTRIM(CSYCISDT), 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END
FROM CSYCLOSED
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'CSY_CLOSED'
UNION ALL
SELECT CUCDDS, DATE1, round((COUNT(distinct ROUTES1) + COUNT(distinct ROUTES)) / 137 * 100,2) as "%COMPLETE",
CASE WHEN round((COUNT(distinct ROUTES1) + COUNT(distinct ROUTES)) / 137 * 100,2) = 100 THEN 'G'
WHEN round((COUNT(distinct ROUTES1) + COUNT(distinct ROUTES)) / 137 * 100,2) < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') = (CURRENT DATE + 1 DAY)  THEN 'R'
WHEN round((COUNT(distinct ROUTES1) + COUNT(distinct ROUTES)) / 137 * 100,2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R'
WHEN round((COUNT(distinct ROUTES1) + COUNT(distinct ROUTES)) / 137 * 100,2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y'
WHEN round((COUNT(distinct ROUTES1) + COUNT(distinct ROUTES)) / 137 * 100,2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y'
WHEN round((COUNT(distinct ROUTES1) + COUNT(distinct ROUTES)) / 137 * 100,2) < 100 AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y'
ELSE '' END
FROM ISDT 
left JOIN A ON DATE1 = OLDDATE
left join A2 ON DATE1 = CURRENT1
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'ROUTES_ACTIVATED'
group by DATE1, CURRENT1, CUCDDS, CUMSFL, CUSHDS
UNION ALL
SELECT CUCDDS, DTISDT, ROUND((COUNT(DISTRO_WAVED)/COUNT(DISTRO)) * 100, 2) AS "%COMPLETE", 
CASE WHEN ROUND((COUNT(DISTRO_WAVED)/COUNT(DISTRO)) * 100, 2) = 100 THEN 'G'
WHEN ROUND((COUNT(DISTRO_WAVED)/COUNT(DISTRO)) * 100, 2) < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(DTISDT), 'YYYYMMDD') <= (CURRENT DATE + 2 DAYS) THEN 'R' 
WHEN ROUND((COUNT(DISTRO_WAVED)/COUNT(DISTRO)) * 100, 2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DTISDT), 'YYYYMMDD') = (CURRENT DATE + 2 DAYS) THEN 'R' 
WHEN ROUND((COUNT(DISTRO_WAVED)/COUNT(DISTRO)) * 100, 2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DTISDT), 'YYYYMMDD') = (CURRENT DATE + 2 DAYS) THEN 'Y' 
WHEN ROUND((COUNT(DISTRO_WAVED)/COUNT(DISTRO)) * 100, 2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(DTISDT), 'YYYYMMDD') = (CURRENT DATE + 2 DAYS) THEN 'Y' 
WHEN ROUND((COUNT(DISTRO_WAVED)/COUNT(DISTRO)) * 100, 2) <= 100 AND TO_DATE(LTRIM(DTISDT), 'YYYYMMDD') > (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END
FROM ALLDISTRO
JOIN waved ON DISTRO=DISTRO_WAVED
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'WAVES_GENERATED'
GROUP BY DTISDT, CUCDDS, CUSHDS, CUMSFL
UNION ALL 
SELECT CUCDDS, DATE1, CASE WHEN MAX(DISTINCT OVWAVES) = '' THEN 0 ELSE ROUND((1-((CAST(COUNT(DISTINCT PIWAVE) AS FLOAT))/(CAST(COUNT(DISTINCT OVWAVES) AS FLOAT))))*100,2) END  AS "%COMPLETE", 
CASE WHEN (CASE WHEN MAX(DISTINCT OVWAVES) = '' THEN 0 ELSE ROUND((1-((CAST(COUNT(DISTINCT PIWAVE) AS FLOAT))/(CAST(COUNT(DISTINCT OVWAVES) AS FLOAT))))*100,2) END )= 100 THEN 'G'
WHEN ROUND((1-((CAST(COUNT(DISTINCT PIWAVE) AS FLOAT))/(CAST(COUNT(DISTINCT OVWAVES) AS FLOAT))))*100,2) < 100 AND CURRENT TIME > CUMSFL AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') <= (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1-((CAST(COUNT(DISTINCT PIWAVE) AS FLOAT))/(CAST(COUNT(DISTINCT OVWAVES) AS FLOAT))))*100,2) < 80 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'R' 
WHEN ROUND((1-((CAST(COUNT(DISTINCT PIWAVE) AS FLOAT))/(CAST(COUNT(DISTINCT OVWAVES) AS FLOAT))))*100,2) BETWEEN 80 AND 100 AND CURRENT TIME BETWEEN CUSHDS AND CUMSFL AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1-((CAST(COUNT(DISTINCT PIWAVE) AS FLOAT))/(CAST(COUNT(DISTINCT OVWAVES) AS FLOAT))))*100,2) < 80 AND CURRENT TIME < CUSHDS AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') = (CURRENT DATE + 1 DAY) THEN 'Y' 
WHEN ROUND((1-((CAST(COUNT(DISTINCT PIWAVE) AS FLOAT))/(CAST(COUNT(DISTINCT OVWAVES) AS FLOAT))))*100,2) <= 100 AND TO_DATE(LTRIM(DATE1), 'YYYYMMDD') >= (CURRENT DATE + 2 DAYS) THEN 'Y' 
ELSE '' END
FROM ISDT
LEFT JOIN WAVES_OV ON OVISDT=DATE1
LEFT JOIN PDWAVES ON PISDT=DATE1
JOIN SHV21BAPD.CUSYST00 ON CUCDID = 'WAVES_CLOSED'
GROUP BY DATE1, CUCDDS, CUSHDS, CUMSFL
ORDER BY 2 DESC 
